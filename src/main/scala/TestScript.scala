/**
  * Created by davinchia on 1/20/17.
  *
  * Used to run quick and dirty tests.
  */

import XHMM._
import Model._
import Utils._

object TestScript {
  def main(args: Array[String]): Unit = {

    //HG00113 and HG00121
    Model.obs = Array(-0.41299542138535994, -0.17490180390834065, -0.1886903954362933, 5.705381609827105, 3.84614534088253, 3.8822764225899706, 4.361319603035853, 5.377935125975705, 3.309127305045965, 2.567932700586726, 2.9226448417596953, -1.425176049639377, 0.7703639470620648, 0.7986864410584029, -0.7881716626570838, -1.0481716629159221, -0.39715144462685303, -1.008721233926663, -0.5285845715168708, 0.40194282031593137, -0.005845512715160396, 0.208503351194057, 0.21984502887548563, 0.11489591016961839, -0.518333693466908, -0.2036526448687854, -0.11694852471165292, -0.24398196212350712, -0.059914669949907545, -0.015416000483052224, 0.21165736464844373, -0.2794477890318955, -0.39660178204027463, -0.6115961304433222, -1.1540928016525038, -0.5943826085744839, -1.6943581134841887, 0.12827478281922852, -0.5626624808544248, -0.8164588598309396, -1.7246958537789816, 0.060621251266108234, 0.07985642137894848, 0.22390403989474425, -1.168704712879237, -0.574945816383214, -0.8972192585488876, -0.45783073121133183, 0.4073359090611979, 0.00784571688484403, 0.07850695363108275, -0.7610024889391638, 1.0915486765719293, 0.4194711608330125, -0.8041094898177343, 0.11630560663154148, -0.29750518922165625, -0.19439963714106767, -0.8290397178015066, -0.5745709114948853, 0.14830697728580666, -2.9494060966841182, -0.5021190051422628, -0.20464438503733404, 1.2588320522294403, -0.688552799821285, -0.8709245607339339, -0.8189779750945482, -0.22835287828848555, -1.0646459192859572, -1.9023941357461422, -1.0129519712227575, -0.5046605268399372, -0.5857827079645878, -0.41914829126167386, -0.9305482060973715, -0.16057297094513856, -0.21718607907621693, 0.08862339370875247, -0.0031263251987375773, -0.26335034082901204, -0.4751824147848261, -0.5919169498671119, 0.6527808019684539, -0.5532552496435065, -0.04379652378302663, -0.1343369175146906, -0.19558491178572826, -0.5902703821189086, -0.4641153729514392, -0.15963630983289825, -0.9485500846805567, -0.38366815399993354, 0.5973522652832822, 0.063259425929353, -0.43465062421969464, 0.34648300482269456, -0.28582449391923276, 1.161698597389376, -0.8579869063124709, 0.14123914193885742, 0.35311371791574636, 0.14728689477016557, 0.5985422027720173, 0.973100546421345, 0.23901197920283085, -0.3615029950211245, 0.3926730419436433, 0.25405032655517495, 0.7297252172286538, 1.0412074333158492, 1.664554471803238, 1.300928661218219, 0.9456642718656647, 0.28011338603212926, 0.8993966962725745, 0.7150309485543244, -0.28417876458864744, 0.19431403069022096, 0.730676334255033, -0.001096990726276442, -0.7373391518063453, 0.42120093897503036, 0.33781241155356495, 0.05933788055583659, 0.18551495643259636, -0.15126191825819657, -0.16865467978009535, -0.3184989140537152, -0.27599577600135694, 0.18384892838022318, 0.10318429784967939, 2.2142703665946297, 0.6642735264532265, -0.09655864003419246, 0.1487470315649175, 0.1868524018790649, -0.023300899115258678, -0.2935699270540008, -0.014035958433090308, 0.2575661223927808, 0.18121429051661855, -0.22561911677558436, 0.5328376600866541, 0.010002545998571666, -0.2594758920112018, -0.25791822846095397, -0.12205958672509015, -0.5631274286372445, -0.3851560663657924, -0.17383704671887715, -0.36422508804252995, -1.2328419371434955, 0.1794611668733193, 1.9078983943460055, -0.10517479810411362, -0.5928902817412423, 0.06383635011518592, -0.36087220929516645, -0.25967025554323714, -1.9731620817965567, -0.40010311002577026, 1.207277012517435, -0.42092893724050306, -2.1441744747219892E-4, -0.23606105893084026, -0.7080811760198379, 1.5243734258329065, -0.8533568287418831, -0.5159752603450781, -0.6475832788289629, 0.012552371787854478, -0.17387953200435496, -0.3092917449755063, -1.748909822222431, -0.8742219789720919, -0.5698871883108405, -2.3485960311243526, -0.7244597619475204, -0.5289280073235504, -0.39810896873775353, 0.22574228886395378, -0.39542098677600457, -1.4389167301449364, -1.507744873361603, -1.3677469673243479, -0.6271333555838458, 0.07076693335277956, 0.20526849360260166, -0.9633904391867886, -1.2469316282481293, -0.19300383283528125, 0.8998162717321841, -0.2545282267038634, -0.5091507669887143, 0.9288516834402663, -0.9601489592209054, 0.9163233413007548, 0.8487863321010698, 0.4655924909179534, -0.9421189749725903, -0.9260246547395681, -0.02047453830872115, 0.08933316801852416, -0.2768044776885456, 0.061940088764151545, -0.2999485576293211, -0.2937267329685674, -0.4334509365269478, 0.21104513366905975, 0.13565577178262964, 1.4803256553725137, -0.30038726508514896, -0.23009051256683408, 0.10721422963406455, 0.11413674127238557, 0.5111860732193523, 0.17982703053147023, 0.4516633214178752, -0.5431511359205725, 0.13596128201601151, -0.24455973203281023, 0.507891522934411, -0.26136659568445614, 0.07212492973297516, -0.6604362222696908, -0.2502811833529639, -0.04729091898068624, 0.17072749333038326, 1.6972255018239955, 0.3825513019326401, 0.017810010777895933, -0.3040713641603809, 0.20404857606490104, -0.3641945737316692, -0.27143200917710486, -0.4448847766866019, -0.16465727504099167, -0.5087883005967095, -0.2226792035785778, -0.062328811004172334, 0.0026452126570638565, 0.4775471770450577, -0.003190292207256803, -0.09025303597150054, -0.3020898086504384, 0.52180771432573, 2.0823992286625708, -0.12100062959092478, 0.09418898100586202, 0.1746273146436808, 0.7135083468314715, -0.32932143493506716, -0.12321987785147442, 0.5920279611807209, -0.7830359220088903, 0.5641543067858067, -0.6837014811691406, 0.4505585619735497, 0.9816869523843937, 0.2060506608106767, 0.23039353574833665, 0.36661490529255486, 0.019569368421358906, -0.1718602944149187)
//    Model.obs = Array(-0.04439849558341829, 0.2945337631886959, -0.06734599520526859, -1.1929921672317882, -0.8245137665370699, -0.8286287876373012, -0.2340391585590159, -0.19035417654266817, -1.327701078344344, -0.22281809698656088, -0.36822459684413134, -1.8613503823886015, 0.4134943001443191, 1.251793144590745, 0.6823228530765186, -2.2652853449317893, 0.9827044915127542, 2.2678522482312045, 1.6594987921941504, 0.49008217670271603, 0.6654266160000677, 0.44969087873588315, 0.4765831124343643, -0.041199172536983075, 0.05313423966698814, 0.16817444164613715, -0.18140680987926222, 0.3975845006909265, 0.1931426321230351, -0.19039144046683218, 0.39664103467136974, 0.8834874706917321, 0.6882802442475181, 2.594424162394695, 1.6710646919644707, 0.4342042914713027, 0.3380911653113545, 0.7526097166860447, -0.3944034594302393, -0.017106717002584537, -0.5417572430328917, -0.40777071582289437, 0.0626313040664321, -1.496365923785879, 0.646967205752354, 0.6783307610743973, 0.4376004795225513, -0.8524839424529087, -1.0716085857095246, 0.3302176173345671, 0.20221799657863282, 1.1564565382079048, -0.024692673019033724, -0.41783129268874974, 1.0590397893465715, -0.16855874097970414, -1.88923675100216, 0.6399851302673425, -1.4947069717409487, -0.7369389166624875, -0.341718244695267, 0.32214066283979104, 0.14361492876516116, -1.1552640014794506, 1.7171131654531007, -0.6440110046941327, -0.8952904636689106, 0.06316669525403064, -0.7214786499414332, -0.08183527885446425, 0.3622235691258805, -0.015134631805693187, -1.3273344668682832, -0.7007467693672935, -0.4976308358681313, -0.19020135269056834, 0.02190158319270703, 0.48428206134286816, -0.29517737017905366, -0.10993943790478072, 0.03925757761746418, -1.614173934417767, -0.10761552159477504, -0.23673619539744425, 0.5519871193463562, -0.3203299252985104, 0.8293509864094972, 0.4054922815158463, 1.3097624475089842, 1.3206806199967018, 0.3137787452616906, 0.1258969747671795, 1.217452407930877, 0.3818164791583109, -0.46003394163356826, 1.7028952037617642, 0.5300290181988896, 1.1458436551651443, -0.41409799836089467, -0.3927381768301749, -0.46891025429019545, -1.54156983980384, -0.6787660775137901, -2.8280707695207807, -1.7512158402681604, -1.5191684336382967, -2.0793302772379394, -1.6762297358686646, -2.9291988210117297, -2.0204239916559166, -2.441822055015851, -5.656691410887467, -3.4591270717509226, -2.00060601108445, -0.4499992798545036, -4.234861253710244, -2.154728096173403, -0.9530987533114382, 0.12870654590354566, 1.3403254925595107, -1.2580867320821583, -0.2575046756068985, 1.2563969757465099, 1.3077803643452854, 0.1990170528488591, 0.5092889833847054, 0.015171910927797183, 0.6830044594272012, -0.5296440342958448, -0.1836758907402382, -0.15344282126925518, 0.18076818512733686, 1.6461354336880034, 1.4021255603540446, 0.2733071841471728, 1.1228562597308853, 0.9883258033899682, 0.37802077339313944, -0.48424119555874895, -0.7840711327972224, 0.8687459070539446, 0.2976008165365575, 1.2000769263858007, 1.2605006618396006, 0.8991449392975418, 0.3773972054553654, 0.9005682045098764, 0.02207376560438358, -0.13967611684959783, -0.1222663347695291, -0.098814345818242, 0.28179146744677214, -0.08345432886328982, 0.6784595749656798, 1.2026275879475323, 0.3936399507982589, -0.1605971846960707, 0.2595184810841093, 2.076456566373181, -0.256863881386723, -1.3009008001487927, 0.0621979559985258, -0.6485419777213909, -0.4487247102756823, 0.513906143716512, -1.0240278744448394, 1.2530057337508957, -0.7495619214686596, -0.9855747206495965, -0.1469182783884664, 0.6352256353741235, -0.3642339225281865, 0.2310294306558393, -0.5075648681753517, 0.24849515698141317, -0.4098685967516798, 2.155102549852834, 0.6588094449671621, -0.3385181733378301, -0.8522022663671533, -1.3967048079176825, -0.036639674927209445, -0.04457269089748045, 0.2314347340950062, 0.7824839867876383, -0.33048108700913326, -0.20789766272009033, 0.1003120654488438, 0.6837818813140523, 0.8910773517109157, -0.23169360780287787, -0.41252829700003113, -0.8822719441608211, 0.9255708288206188, -0.49732619534602585, 1.0377187170664213, 0.8268466493255245, 0.18596518917624552, -0.05416735563435955, -0.14289409000547182, 0.9173691429364974, 0.13941551847194367, 1.2990601932398058, 1.284211762531045, 0.6401148272797096, 0.42436650529093395, -0.6636784195388987, 0.09220017326187066, 0.6099018299471117, 0.7782972321327226, 0.13259539945552232, -0.4666310033855597, -0.3924625175826162, -0.3423038187953745, 0.17760490428886916, 0.49566374294462284, 0.27196585789091293, 0.4333354426698316, 1.0159301281802975, 0.06945517473054454, -0.5404910679417073, 0.11937175846566338, -0.6213738383460462, 0.007637864188072923, 0.3537457416832751, 0.1805486114079649, 0.1671174807267141, 0.3656501472766916, -0.20412850149012704, 0.37873989221849863, -0.25451351653484283, -0.28947148830812575, -0.3504993677668825, 0.5955891170573425, 0.7189480135046891, 0.6350901382959643, 0.2404931334703114, 0.2906999397639041, 0.48270282966069816, -0.16661233814882065, -0.1093217158124907, 0.4939674441318675, 1.0099196567309774, 0.7188854714175238, 0.06378946436657945, -0.5255369565157321, 0.07831074890286265, -0.5768697207299658, 1.2163620435547904, 0.8335070337914677, 0.36730443169185545, -0.009857971513252368, 0.7466864394160395, -0.2294975146357701, 0.6088710702141904, 1.8309312164127463, 0.19062117741891124, 1.319190493080838, -0.6083380730953545, -0.679793647321504, 0.22132778949639012, 0.14399258879074311, 0.10561755658554486, -0.44972639937283854, -0.520177945028697)
    var t0 = System.nanoTime()

    calc_common_variables()
    Model.calc_probabilities_for_sample() // Calculate transition and emission probabilities

    val path = viterbi(obs, states, start, transitions, emissions)
    val (beginIdx, endIdx, state) = search_for_non_diploid(path)

    println(beginIdx, endIdx, state)

    if (beginIdx != -1) {
      var exclude = if (state == 1) 2 else 1

      val someScore = some_score(beginIdx, endIdx, exclude)
      println(someScore)
      println(exact_score(beginIdx, endIdx, state))
      println("Path: ")
      println(path)
      if (someScore >= minSomeScore) {
        println(" CNV: " + state + " begin: " + (beginIdx+1) + " end: " + (endIdx+1)
          + " exact score: " + exact_score(beginIdx, endIdx, state) + " some score: " + someScore)
      }
    }
    var t1 = System.nanoTime()

    println("Elapsed Time: " + (t1 - t0)/1000000 + " milliseconds")
  }
}
